---
redirect_from:
  - "/explore/segregation/decomposition-wrapper-example"
interact_link: content/explore/segregation/decomposition_wrapper_example.ipynb
kernel_name: python3
kernel_path: content/explore/segregation
has_widgets: false
title: |-
  decomposition_wrapper_example
pagenum: 27
prev_page:
  url: /explore/segregation/compute_all_example.html
next_page:
  url: /explore/segregation/inference_wrappers_example.html
suffix: .ipynb
search: composition approach metropolitan area component decomposition segregation map share lets population group data difference different counterfactual los angeles new york index total both spatial attribute framework pysal module default dual inspecting relative concentration download similar read unit also into respectively case possible table notebook step comparative import going census should type file zipped looks variable us cities previous build frequency inspect compare check structure role since absolute plotting cdfs maps contexts note takes consideration complementary importance however contents explains procedure perform measures needed libraries example user must its own copy following guidelines explained github com spatialucr geosnap blob master examples

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">decomposition_wrapper_example</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Table-of-Contents">Table of Contents<a class="anchor-link" href="#Table-of-Contents"> </a></h1><ul>
<li><a href="#Decomposition-framework-of-the-PySAL-*segregation*-module">Decomposition framework of the PySAL <em>segregation</em> module</a><ul>
<li><a href="#Map-of-the-composition-of-the-Metropolitan-area-of-Los-Angeles">Map of the composition of the Metropolitan area of Los Angeles</a></li>
<li><a href="#Map-of-the-composition-of-the-Metropolitan-area-of-New-York">Map of the composition of the Metropolitan area of New York</a></li>
<li><a href="#Composition-Approach-%28default%29">Composition Approach (default)</a></li>
<li><a href="#Share-Approach">Share Approach</a></li>
<li><a href="#Dual-Composition-Approach">Dual Composition Approach</a></li>
<li><a href="#Inspecting-a-different-index:-Relative-Concentration">Inspecting a different index: Relative Concentration</a></li>
</ul>
</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Decomposition-framework-of-the-PySAL-segregation-module">Decomposition framework of the PySAL <em>segregation</em> module<a class="anchor-link" href="#Decomposition-framework-of-the-PySAL-segregation-module"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a notebook that explains a step-by-step procedure to perform decomposition on comparative segregation measures.</p>
<p>First, let's import all the needed libraries.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">segregation</span>
<span class="kn">from</span> <span class="nn">segregation.decomposition</span> <span class="kn">import</span> <span class="n">DecomposeSegregation</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this example, we are going to use census data that the user must download its own copy, following similar guidelines explained in <a href="https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb">https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</a> where you should download the full type file  of 2010. The zipped file download will have a name that looks like <code>LTDB_Std_All_fullcount.zip</code>. After extracting the zipped content, the filepath of the data should looks like this:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#filepath = &#39;~/LTDB_Std_2010_fullcount.csv&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then, we read the data:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;ISO-8859-1&quot;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We are going to work with the variable of the nonhispanic black people (<code>nhblk10</code>) and the total population of each unit (<code>pop10</code>). So, let's read the map of all census tracts of US and select some specific columns for the analysis:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This file can be download here: https://drive.google.com/open?id=1gWF0OCn6xuR_WrEj7Ot2jY6KI2t6taIm</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/tracts_US.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">input</span><span class="p">:</span>
    <span class="n">map_gpd</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    
<span class="n">map_gpd</span><span class="p">[</span><span class="s1">&#39;INTGEOID10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">map_gpd</span><span class="p">[</span><span class="s2">&quot;GEOID10&quot;</span><span class="p">])</span>
<span class="n">gdf_pre</span> <span class="o">=</span> <span class="n">map_gpd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;INTGEOID10&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;tractid&#39;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf_pre</span><span class="p">[[</span><span class="s1">&#39;GEOID10&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;pop10&#39;</span><span class="p">,</span> <span class="s1">&#39;nhblk10&#39;</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this notebook, we use the Metropolitan Statistical Area (MSA) of US (we're also using the word 'cities' here to refer them). So, let's read the correspondence table that relates the tract id with the corresponding Metropolitan area...</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># You can download this file here: https://drive.google.com/open?id=10HUUJSy9dkZS6m4vCVZ-8GiwH0EXqIau</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/tract_metro_corresp.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">input</span><span class="p">:</span>
    <span class="n">tract_metro_corresp</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>..and merge them with the previous data.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged_gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tract_metro_corresp</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;GEOID10&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;geoid10&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We now build the composition variable (<code>compo</code>) which is the division of the frequency of the chosen group and total population. Let's inspect the first rows of the data.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged_gdf</span><span class="p">[</span><span class="s1">&#39;compo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">merged_gdf</span><span class="p">[</span><span class="s1">&#39;pop10&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">merged_gdf</span><span class="p">[</span><span class="s1">&#39;nhblk10&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">merged_gdf</span><span class="p">[</span><span class="s1">&#39;pop10&#39;</span><span class="p">])</span>
<span class="n">merged_gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GEOID10</th>
      <th>geometry</th>
      <th>pop10</th>
      <th>nhblk10</th>
      <th>geoid10</th>
      <th>metro_id</th>
      <th>numeric_id</th>
      <th>geoid</th>
      <th>name</th>
      <th>compo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01001020801</td>
      <td>POLYGON ((-86.456273 32.405837, -86.4570349999...</td>
      <td>3081</td>
      <td>293</td>
      <td>01001020801</td>
      <td>33860</td>
      <td>33860</td>
      <td>33860</td>
      <td>Montgomery, AL</td>
      <td>0.095099</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01001020802</td>
      <td>POLYGON ((-86.412497 32.589422, -86.412442 32....</td>
      <td>10435</td>
      <td>1420</td>
      <td>01001020802</td>
      <td>33860</td>
      <td>33860</td>
      <td>33860</td>
      <td>Montgomery, AL</td>
      <td>0.136080</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01001020200</td>
      <td>POLYGON ((-86.467354 32.459308, -86.46764 32.4...</td>
      <td>2170</td>
      <td>1226</td>
      <td>01001020200</td>
      <td>33860</td>
      <td>33860</td>
      <td>33860</td>
      <td>Montgomery, AL</td>
      <td>0.564977</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01001020700</td>
      <td>POLYGON ((-86.46106999999999 32.42709, -86.461...</td>
      <td>2891</td>
      <td>452</td>
      <td>01001020700</td>
      <td>33860</td>
      <td>33860</td>
      <td>33860</td>
      <td>Montgomery, AL</td>
      <td>0.156347</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01001020600</td>
      <td>POLYGON ((-86.470524 32.456117, -86.4700469999...</td>
      <td>3668</td>
      <td>776</td>
      <td>01001020600</td>
      <td>33860</td>
      <td>33860</td>
      <td>33860</td>
      <td>Montgomery, AL</td>
      <td>0.211559</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we chose two different metropolitan areas to compare the degree of segregation.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Map-of-the-composition-of-the-Metropolitan-area-of-Los-Angeles">Map of the composition of the Metropolitan area of Los Angeles<a class="anchor-link" href="#Map-of-the-composition-of-the-Metropolitan-area-of-Los-Angeles"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">la_2010</span> <span class="o">=</span> <span class="n">merged_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">merged_gdf</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Los Angeles-Long Beach-Anaheim, CA&quot;</span><span class="p">)]</span>
<span class="n">la_2010</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;compo&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;OrRd&#39;</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(-119.02865769999998, -117.3360503, 32.6463769, 34.9269651)</pre>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/explore/segregation/decomposition_wrapper_example_18_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Map-of-the-composition-of-the-Metropolitan-area-of-New-York">Map of the composition of the Metropolitan area of New York<a class="anchor-link" href="#Map-of-the-composition-of-the-Metropolitan-area-of-New-York"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ny_2010</span> <span class="o">=</span> <span class="n">merged_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">merged_gdf</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;New York-Newark-Jersey City, NY-NJ-PA&#39;</span><span class="p">)]</span>
<span class="n">ny_2010</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;compo&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;OrRd&#39;</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(-75.5381038, -71.59841419999998, 39.36886419999999, 41.70820779999999)</pre>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/explore/segregation/decomposition_wrapper_example_20_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We first compare the Gini index of both cities. Let's import the <code>Gini_Seg</code> class from <code>segregation</code>, fit both indexes and check the difference in point estimation.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">segregation.aspatial</span> <span class="kn">import</span> <span class="n">GiniSeg</span>

<span class="n">G_la</span> <span class="o">=</span> <span class="n">GiniSeg</span><span class="p">(</span><span class="n">la_2010</span><span class="p">,</span> <span class="s1">&#39;nhblk10&#39;</span><span class="p">,</span> <span class="s1">&#39;pop10&#39;</span><span class="p">)</span>
<span class="n">G_ny</span> <span class="o">=</span> <span class="n">GiniSeg</span><span class="p">(</span><span class="n">ny_2010</span><span class="p">,</span> <span class="s1">&#39;nhblk10&#39;</span><span class="p">,</span> <span class="s1">&#39;pop10&#39;</span><span class="p">)</span>

<span class="n">G_la</span><span class="o">.</span><span class="n">statistic</span> <span class="o">-</span> <span class="n">G_ny</span><span class="o">.</span><span class="n">statistic</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>-0.10652888790131243</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's decompose these difference according to <em>Rey, S. et al "Comparative Spatial Segregation Analytics". Forthcoming</em>. You can check the options available in this decomposition below:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">DecomposeSegregation</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on class DecomposeSegregation in module segregation.decomposition.decompose_segregation:

class DecomposeSegregation(builtins.object)
 |  Decompose segregation differences into spatial and attribute components.
 |  
 |  Given two segregation indices of the same type, use Shapley decomposition
 |  to measure whether the differences between index measures arise from
 |  differences in spatial structure or population structure
 |  
 |  Parameters
 |  ----------
 |  index1 : segregation.SegIndex class
 |      First SegIndex class to compare.
 |  index2 : segregation.SegIndex class
 |      Second SegIndex class to compare.
 |  counterfactual_approach : str, one of
 |                            [&#34;composition&#34;, &#34;share&#34;, &#34;dual_composition&#34;]
 |      The technique used to generate the counterfactual population
 |      distributions.
 |  
 |  Attributes
 |  ----------
 |  
 |  c_s : float
 |      Shapley&#39;s Spatial Component of the decomposition
 |              
 |  c_a : float
 |      Shapley&#39;s Attribute Component of the decomposition
 |  
 |  Methods
 |  ----------
 |  
 |  plot : Visualize features of the Decomposition performed
 |      plot_type : str, one of [&#39;cdfs&#39;, &#39;maps&#39;]
 |      
 |      &#39;cdfs&#39; : visualize the cumulative distribution functions of the compositions/shares
 |      &#39;maps&#39; : visualize the spatial distributions for original data and counterfactuals generated and Shapley&#39;s components (only available for GeoDataFrames)
 |  
 |  Examples
 |  --------
 |  Several examples can be found at https://github.com/pysal/segregation/blob/master/notebooks/decomposition_wrapper_example.ipynb.
 |  
 |  Methods defined here:
 |  
 |  __init__(self, index1, index2, counterfactual_approach=&#39;composition&#39;)
 |      Initialize self.  See help(type(self)) for accurate signature.
 |  
 |  plot(self, plot_type=&#39;cdfs&#39;)
 |      Plot the Segregation Decomposition Profile
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Composition-Approach-(default)">Composition Approach (default)<a class="anchor-link" href="#Composition-Approach-(default)"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The difference of -0.10653 fitted previously, can be decomposed into two components. The Spatial component and the attribute component. Let's estimate both, respectively.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DS_composition</span> <span class="o">=</span> <span class="n">DecomposeSegregation</span><span class="p">(</span><span class="n">G_la</span><span class="p">,</span> <span class="n">G_ny</span><span class="p">)</span>
<span class="n">DS_composition</span><span class="o">.</span><span class="n">c_s</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.029575766160051364</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DS_composition</span><span class="o">.</span><span class="n">c_a</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>-0.1361046540613638</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, the first thing to notice is that attribute component, i.e., given by a difference in the population structure (in this case, the composition) plays a more important role in the difference, since it has a higher absolute value.</p>
<p>The difference in the composition can be inspected in the plotting method with the type <code>cdfs</code>:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DS_composition</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;cdfs&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/explore/segregation/decomposition_wrapper_example_30_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If your data is a GeoDataFrame, it is also possible to visualize the counterfactual compositions with the argument <code>plot_type = 'maps'</code></p>
<p>The first and second contexts are Los Angeles and New York, respectively.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DS_composition</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;maps&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/explore/segregation/decomposition_wrapper_example_32_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Note that in all plotting methods, the title presents each component of the decomposition performed.</em></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Share-Approach">Share Approach<a class="anchor-link" href="#Share-Approach"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The share approach takes into consideration the share of each group in each city. Since this approach takes into consideration the focus group and the complementary group share to build the "counterfactual" total population of each unit, it is of interest to inspect all these four cdf's.</p>
<p><em>ps.: The share is the population frequency of each group in each unit over the total population of that respectively group.</em></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DS_share</span> <span class="o">=</span> <span class="n">DecomposeSegregation</span><span class="p">(</span><span class="n">G_la</span><span class="p">,</span> <span class="n">G_ny</span><span class="p">,</span> <span class="n">counterfactual_approach</span> <span class="o">=</span> <span class="s1">&#39;share&#39;</span><span class="p">)</span>
<span class="n">DS_share</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;cdfs&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/explore/segregation/decomposition_wrapper_example_36_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see that curve between the contexts are closer to each other which represent a drop in the importance of the population structure (attribute component) to -0.062. However, this attribute still overcomes the spatial component (-0.045) in terms of importance due to both absolute magnitudes.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DS_share</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;maps&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/explore/segregation/decomposition_wrapper_example_38_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see that the counterfactual maps of the composition (outside of the main diagonal), in this case, are slightly different from the previous approach.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Dual-Composition-Approach">Dual Composition Approach<a class="anchor-link" href="#Dual-Composition-Approach"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>dual_composition</code> approach is similar to the composition approach. However, it uses also the counterfactual composition of the cdf of the complementary group.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DS_dual</span> <span class="o">=</span> <span class="n">DecomposeSegregation</span><span class="p">(</span><span class="n">G_la</span><span class="p">,</span> <span class="n">G_ny</span><span class="p">,</span> <span class="n">counterfactual_approach</span> <span class="o">=</span> <span class="s1">&#39;dual_composition&#39;</span><span class="p">)</span>
<span class="n">DS_dual</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;cdfs&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/explore/segregation/decomposition_wrapper_example_42_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is possible to see that the component values are very similar with slight changes from the <code>composition</code> approach.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DS_dual</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;maps&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/explore/segregation/decomposition_wrapper_example_44_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The counterfactual distributions are virtually the same (but not equal) as the one from the <code>composition</code> approach.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Inspecting-a-different-index:-Relative-Concentration">Inspecting a different index: Relative Concentration<a class="anchor-link" href="#Inspecting-a-different-index:-Relative-Concentration"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">segregation.spatial</span> <span class="kn">import</span> <span class="n">RelativeConcentration</span>

<span class="n">RCO_la</span> <span class="o">=</span> <span class="n">RelativeConcentration</span><span class="p">(</span><span class="n">la_2010</span><span class="p">,</span> <span class="s1">&#39;nhblk10&#39;</span><span class="p">,</span> <span class="s1">&#39;pop10&#39;</span><span class="p">)</span>
<span class="n">RCO_ny</span> <span class="o">=</span> <span class="n">RelativeConcentration</span><span class="p">(</span><span class="n">ny_2010</span><span class="p">,</span> <span class="s1">&#39;nhblk10&#39;</span><span class="p">,</span> <span class="s1">&#39;pop10&#39;</span><span class="p">)</span>

<span class="n">RCO_la</span><span class="o">.</span><span class="n">statistic</span> <span class="o">-</span> <span class="n">RCO_ny</span><span class="o">.</span><span class="n">statistic</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>-0.4252237137424809</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">RCO_DS_composition</span> <span class="o">=</span> <span class="n">DecomposeSegregation</span><span class="p">(</span><span class="n">RCO_la</span><span class="p">,</span> <span class="n">RCO_ny</span><span class="p">)</span>
<span class="n">RCO_DS_composition</span><span class="o">.</span><span class="n">c_s</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>-0.37586237172215886</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">RCO_DS_composition</span><span class="o">.</span><span class="n">c_a</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>-0.049361342020322</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is possible to note that, in this case, the spatial component is playing a much more relevant role in the decomposition.</p>

</div>
</div>
</div>
</div>

 


    </main>
    